<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <title>A Pelican Blog - python</title>
        <link rel="stylesheet" href="/theme/css/main.css">
                <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />
                
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                                                                                    <li ><a href="/category/misc.html">Misc</a></li>
                                    <li ><a href="/category/rpi.html">RPi</a></li>
                                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/pyload-webserver-jinja2-probleme.html">Pyload Webserver (Jinja2)-Probleme</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2013-07-09T12:56:00">
                Di 09 Juli 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="/author/x4343.html">x4343</a>
        </address>
        <p>In <a href="/category/rpi.html">RPi</a>. </p>
<p>tags: <a href="/tag/raspberry_pi.html">raspberry_pi</a><a href="/tag/pyload.html">pyload</a><a href="/tag/python.html">python</a><a href="/tag/jinja2.html">jinja2</a></p>
</footer><!-- /.post-info --><p>Seitdem ich meinen RPi nutze um damit diese <a href="http://blog.getpelican.com/">pelican</a> Seiten zu generieren, funktionierte der
<a href="http://pyload.org/de:start">pyload</a> Webserver (threaded) nicht mehr.</p>
<p>Ich hab pyload bereits seit einigen Monaten laufen - unabhaengig davon, ob ich es nutze.
Zieht ja kaum Performance...</p>
<p>$\delta t = 0 s$</p>
<p>Der Server und alles andere laeuft auch nach wie vor problemlos. Erst nachdem man via Browser
auf das Webinterface zugreifen moechte, kommt eine Fehler, der jeder weitere Arbeit unterbindet!</p>
<blockquote>
<p>Critical Error while processing request</p>
</blockquote>
<p>Durch Einschalten der Debug-Ausgabe in der pyload.conf (in $HOME/.pyload)...</p>
<div class="highlight"><pre>bool debug_mode : <span class="s2">&quot;Debug Mode&quot;</span> <span class="o">=</span> True
</pre></div>


<p>...wird die Fehlermeldung schon etwas klarer:</p>
<div class="highlight"><pre><span class="n">Critical</span> <span class="n">error</span> <span class="k">while</span> <span class="n">processing</span> <span class="n">request:</span> 
<span class="n">Error:</span> 
<span class="n">UndefinedError</span><span class="p">(</span><span class="s">&quot;&#39;_&#39; is undefined&quot;</span><span class="p">,)</span> 

<span class="n">Traceback:</span> 

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="k">last</span><span class="p">):</span>
    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/lib/bottle.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">820</span><span class="p">,</span> <span class="n">in</span> <span class="n">wsgi</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">(</span><span class="n">environ</span><span class="p">),</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/lib/bottle.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">773</span><span class="p">,</span> <span class="n">in</span> <span class="n">_cast</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">self</span><span class="o">.</span><span class="n">error_handler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">repr</span><span class="p">)</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/web/pyload_app.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">53</span><span class="p">,</span> <span class="n">in</span> <span class="n">error500</span>
        <span class="n">error</span><span class="o">.</span><span class="n">traceback</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">traceback</span> <span class="k">else</span> <span class="s">&quot;No Traceback&quot;</span><span class="p">])</span>
    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/web/pyload_app.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">72</span><span class="p">,</span> <span class="n">in</span> <span class="n">base</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;base.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;messages&#39;</span><span class="p">:</span> <span class="n">messages</span><span class="p">},</span> <span class="p">[</span><span class="n">pre_processor</span><span class="p">])</span>
    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/web/utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">30</span><span class="p">,</span> <span class="n">in</span> <span class="n">render_to_response</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">File</span> <span class="s">&quot;/usr/local/lib/python2.7/dist-packages/jinja2/environment.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">969</span><span class="p">,</span> <span class="n">in</span> <span class="n">render</span>
        <span class="k">return</span> <span class="n">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">exc_info</span><span class="p">,</span> <span class="n">True</span><span class="p">)</span>
    <span class="n">File</span> <span class="s">&quot;/usr/local/lib/python2.7/dist-packages/jinja2/environment.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">742</span><span class="p">,</span> <span class="n">in</span> <span class="n">handle_exception</span>
        <span class="n">reraise</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/web/templates/default/base.html&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">20</span><span class="p">,</span> <span class="n">in</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">template</span> <span class="n">code</span> 

    <span class="n">File</span> <span class="s">&quot;/usr/share/pyload/module/web/templates/default/base.html&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">20</span><span class="p">,</span> <span class="n">in</span> <span class="n">block</span> <span class="s">&quot;title&quot;</span> 

<span class="n">UndefinedError:</span> <span class="s">&#39;_&#39;</span> <span class="n">is</span> <span class="n">undefined</span> 
</pre></div>


<p>Durch ueberfliegen des Tracebacks wird mir als python-Laie klar, dass irgendwas
mit dem Paket <em>Jinja2</em> nicht in Ordnung ist.</p>
<p>Zufaellig wusste ich, dass <em>Jinja2</em> auch fuer die <a href="http://docs.getpelican.com/en/3.2/themes.html">Templates</a>
von Pelican genutzt wird.
Irgendwas muss da durcheinander gekommen sein.</p>
<p>Da ich nichts zu verlieren hatte, wurde pyload runtergeschmissen und komplett neu installiert.
Wie so oft schon geschehen, versprach ich mir auch diesmal eine Art Selbstheilung...</p>
<p>Leider traf dies nicht ganz zu, doch eine hilfreiche Warnung erschien, die mir das 
vermutete Problem mit <em>Jinja2</em> bestaetigte:</p>
<blockquote>
<p>"Ihre installierte Version 2.7 von jinja2 scheint veraltet zu sein.
Sie koennen problemlos fortfahren, sollte jedoch das Webinterface nicht funktionieren,
sollten Sie es upgraden oder deinstallieren, pyload bringt eine ausreichende jinja2
Bibliothek mit.</p>
<p>jinja2: fehlt"</p>
</blockquote>
<p>Das Webinterface funktionierte immer noch nicht. Also folgte ich den Ratschlaegen des
Installers und wagte mich daran <em>jinja2</em> auch neuzuinstallieren. Mir war unwohl dabei,
da ich nicht wusste, ob pelican danach noch funktionieren wuerde...<em>(haette ich doch damals nicht
den dringenden Hinweisen der pelican Entwickler ignoriert, das ganze unbedingt in einem eigenen python
Environment zu installieren um gerade solcheC Cross-Kompatibilitaets-Problemen aus dem Weg zu
gehen.)</em></p>
<p>Also: <em>jinja2</em> deinstallieren... </p>
<div class="highlight"><pre>pip uninstall jinja2
</pre></div>


<p>...und erneut aufspielen:</p>
<div class="highlight"><pre>pip install jinja2
</pre></div>


<p>und Webinterface testen: <em>erfolglos!</em> - Same Error!</p>
<p>Die einzige Loesung, die mir als nicht-Programmierer blieb, aus den ganzen gesammelten
Fehlerfragmenten schlau zu werden, war wieder einmal Foren-Recherche!</p>
<p>Ich erhoffte mir nicht viel davon, weil ich bereits vorher schonmal die pyload Foren vergebens
durchsucht habe und dorkeweiteren hilfreichen Ratschlaege fand.</p>
<p>Doch durch Gottes Weisung fand ich die Loesung in einem <a href="https://github.com/mitsuhiko/jinja2/issues/225">Github Ticket</a>.</p>
<p>Es fiel mir wie Schuppen von den Augen: &gt; Da waere ich nie von selbst drauf gekommen!</p>
<p>Der Ratschlag ist so professionell wie <a href="/static/pictures/pyload/09-07-2013_jinja2-1.png">simpel</a>:</p>
<div class="highlight"><pre>sudo nano /usr/local/lib/python2.7/dist-packages/jinja2/loaders.py
<span class="c"># In nano zu Zeile 352 springen: STRG-W, STRG-T, 352</span>
<span class="c"># Den Rueckgabewert um *globals* ergaenzen:</span>
<span class="k">return </span>loader.load<span class="o">(</span>environment, local_name, globals<span class="o">)</span>
<span class="c"># Speichern: STRG-X, y</span>
</pre></div>


<p>Und wieder einmal wurde bewiesen, wie aufschlussreich eine vernuenftige Webrecherche ist.
Die ganze Vorarbeit haette ich mir auch sparen koennen...</p>                </article>
                                                                </aside><!-- /#featured -->
                                                </ol><!-- /#posts-list -->
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>